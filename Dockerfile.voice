FROM python:3.11-slim

WORKDIR /app

# ğŸ“‚ Copier ton code
COPY backend/ ./backend/
COPY requirements-voice.txt ./

# ğŸ› ï¸ Installer les dÃ©pendances systÃ¨me
RUN apt-get update && apt-get install -y \
    gcc \
    libasound-dev \
    portaudio19-dev \
    libportaudio2 \
    libportaudiocpp0 \
    espeak \
    ffmpeg \
    libffi-dev \
    unzip \
    wget \
    && rm -rf /var/lib/apt/lists/*

# ğŸ“¦ Installer les dÃ©pendances Python
RUN pip install --upgrade pip \
    && pip install -r requirements-voice.txt

# ğŸ“¥ TÃ©lÃ©charger et dÃ©compresser le modÃ¨le VOSK FR
RUN mkdir -p backend/vosk_model \
    && wget -O vosk-model-small-fr-0.22.zip https://archive.org/download/vosk-models-small/vosk-model-small-fr-0.22.zip \
    && unzip vosk-model-small-fr-0.22.zip -d backend/vosk_model \
    && rm vosk-model-small-fr-0.22.zip

CMD ["python", "backend/jarvis_voice.py"]